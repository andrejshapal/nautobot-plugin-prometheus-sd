---
name: "CI - Integration Branch"
on:  # yamllint disable
  pull_request:
    branches:
      - 'v*.*.*'
jobs:
  tests-nautobot-prometheus-sd:
    name: "Unit tests (Nautobot Prometheus SD and Python 3.12)"
    runs-on: "ubuntu-24.04"
    env:
      INVOKE_NAUTOBOT_LOCAL: "True"
      NAUTOBOT_DB_USER: "nautobot"
      NAUTOBOT_DB_PASSWORD: "decinablesprewad"
      NAUTOBOT_DB_ENGINE: "django_prometheus.db.backends.postgresql"
    services:
      postgres:
        image: "postgres:13-alpine"
        env:
          POSTGRES_USER: "nautobot"
          POSTGRES_PASSWORD: "decinablesprewad"
          POSTGRES_DB: "nautobot"
        ports:
          - "5432:5432"
      redis:
        image: "redis:6-alpine"
        ports:
          - "6379:6379"
    steps:
      - name: "Check out repository code"
        uses: "actions/checkout@v4"
      - name: "Setup environment"
        uses: "networktocode/gh-action-setup-poetry-environment@v6"
        with:
          poetry-install-options: ""  # override default "--only dev"
          poetry-version: "1.8.5"
          python-version: "3.12"
      - name: "Installing plugin"
        run: "poetry install"
      - name: "Performing tests"
        run: "nautobot-server test nautobot_prometheus_sd"
